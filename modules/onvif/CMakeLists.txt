FIND_LIBRARY(SSL libssl.so REQUIRED)
FIND_LIBRARY(CRYPTO libcrypto.so REQUIRED)
FIND_LIBRARY(DL libdl.so REQUIRED)
FIND_LIBRARY(PTHREAD libpthread.so REQUIRED)

AUX_SOURCE_DIRECTORY(. ONVIF_BASE)
LIST(REMOVE_ITEM ONVIF-BASE onvifstub.c)
ADD_LIBRARY(onvif_base SHARED)
SET_TARGET_PROPERTIES(onvif_base PROPERTIES VERSION 0.0.2 SOVERSION 0)
TARGET_SOURCES(onvif_base PRIVATE ${ONVIF_BASE})
TARGET_LINK_LIBRARIES(onvif_base PRIVATE ${SSL} ${CRYPTO} ${DL} ${PTHREAD} onvif_custom)

ADD_SUBDIRECTORY(custom)
ADD_SUBDIRECTORY(plugins)

INSTALL(TARGETS onvif_base
		LIBRARY DESTINATION onvif/lib)
INSTALL(FILES namespace.h soapH.h soapStub.h stdsoap2.h
		DESTINATION onvif/include)

SET(ONVIF_LIB onvifstub.c)
ADD_LIBRARY(onvif_core SHARED)
SET_TARGET_PROPERTIES(onvif_core PROPERTIES VERSION 0.0.2 SOVERSION 0)
TARGET_SOURCES(onvif_core PRIVATE ${ONVIF_LIB})
TARGET_LINK_LIBRARIES(onvif_core PRIVATE onvif_plugins)

install(TARGETS onvif_core
		LIBRARY DESTINATION onvif/lib)