FIND_LIBRARY(SSL ssl REQUIRED)
FIND_LIBRARY(CRYPTO crypto REQUIRED)
FIND_LIBRARY(DL dl REQUIRED)
FIND_LIBRARY(PTHREAD pthread REQUIRED)

AUX_SOURCE_DIRECTORY(. ONVIF_BASE)
ADD_LIBRARY(onvif_base SHARED)
SET_TARGET_PROPERTIES(onvif_base PROPERTIES VERSION 0.0.2 SOVERSION 0)
TARGET_SOURCES(onvif_base PRIVATE ${ONVIF_BASE})
set_target_properties(onvif_base PROPERTIES LINK_FLAGS "${LINK_FLAGS} -Wl,--wrap,malloc -Wl,--wrap,free")
TARGET_LINK_LIBRARIES(onvif_base PRIVATE ${SSL} ${CRYPTO} ${DL} ${PTHREAD} onvif_custom onvif_memory)

ADD_SUBDIRECTORY(custom)
ADD_SUBDIRECTORY(plugins)

INSTALL(TARGETS onvif_base
		LIBRARY DESTINATION onvif/lib)
INSTALL(FILES namespace.h soapH.h soapStub.h stdsoap2.h
		DESTINATION onvif/include)