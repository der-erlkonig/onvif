FIND_LIBRARY(SSL libssl.so REQUIRED)
FIND_LIBRARY(SSL_STATIC libssl.a REQUIRED)
FIND_LIBRARY(CRYPTO libcrypto.so REQUIRED)
FIND_LIBRARY(CRYPTO_STATIC libcrypto.a REQUIRED)
FIND_LIBRARY(DL libdl.so REQUIRED)
FIND_LIBRARY(DL_STATIC libdl.a REQUIRED)
FIND_LIBRARY(PTHREAD libpthread.so REQUIRED)
FIND_LIBRARY(PTHREAD_STATIC libpthread.a REQUIRED)

AUX_SOURCE_DIRECTORY(. ONVIF_BASE)
LIST(REMOVE_ITEM ONVIF-BASE onvifstub.c)
ADD_LIBRARY(onvif_base SHARED)
SET_TARGET_PROPERTIES(onvif_base PROPERTIES VERSION 0.0.2 SOVERSION 0)
TARGET_SOURCES(onvif_base PRIVATE ${ONVIF_BASE})
TARGET_LINK_LIBRARIES(onvif_base PRIVATE ${SSL} ${CRYPTO} ${DL} ${PTHREAD} onvif_custom)

ADD_LIBRARY(onvif_base_static)
SET_TARGET_PROPERTIES(onvif_base_static PROPERTIES VERSION 0.0.2 SOVERSION 0)
SET_TARGET_PROPERTIES(onvif_base_static PROPERTIES OUTPUT_NAME "onvif_base")
TARGET_SOURCES(onvif_base_static PRIVATE ${ONVIF_BASE})
TARGET_LINK_LIBRARIES(onvif_base_static PRIVATE ${SSL_STATIC} ${CRYPTO_STATIC} ${DL_STATIC} ${PTHREAD_STATIC} onvif_custom_static)

ADD_SUBDIRECTORY(custom)
ADD_SUBDIRECTORY(plugins)

INSTALL(TARGETS onvif_base onvif_base_static 
		EXPORT onvif_base_target
		LIBRARY DESTINATION onvif/lib
		ARCHIVE DESTINATION onvif/lib)
INSTALL(FILES namespace.h soapH.h soapStub.h stdsoap2.h
		DESTINATION onvif/include)

SET(ONVIF_LIB onvifstub.c)
ADD_LIBRARY(onvif_core SHARED)
SET_TARGET_PROPERTIES(onvif_core PROPERTIES VERSION 0.0.2 SOVERSION 0)
TARGET_SOURCES(onvif_core PRIVATE ${ONVIF_LIB})
TARGET_LINK_LIBRARIES(onvif_core PRIVATE onvif_plugins)

ADD_LIBRARY(onvif_core_static)
SET_TARGET_PROPERTIES(onvif_core_static PROPERTIES VERSION 0.0.2 SOVERSION 0)
SET_TARGET_PROPERTIES(onvif_core_static PROPERTIES OUTPUT_NAME "onvif_core")
TARGET_SOURCES(onvif_core_static PRIVATE ${ONVIF_LIB})
TARGET_LINK_LIBRARIES(onvif_core_static PRIVATE onvif_plugins)